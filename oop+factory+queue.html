<!DOCTYPE html>
<html lang="he">

<head>
    <meta charset="UTF-8">
    <title>מעלית עם תור</title>
    <style>
        body {
            direction: rtl;
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h2 {
            text-align: center;
        }

        .building-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        .building {
            display: flex;
            flex-direction: column-reverse;
            align-items: flex-start;
        }

        .floor-row {
            display: flex;
            align-items: center;
            height: 40px;
        }

        .floor {
            width: 200px;
            display: flex;
            align-items: center;
            background-color: silver;
            background-image: linear-gradient(335deg, #b00 23px, transparent 23px),
                linear-gradient(155deg, #d00 23px, transparent 23px),
                linear-gradient(335deg, #b00 23px, transparent 23px),
                linear-gradient(155deg, #d00 23px, transparent 23px);
            background-size: 58px 58px;
            background-position: 0px 2px, 4px 35px, 29px 31px, 34px 6px;
            padding-right: 10px;
        }

        .floor-button {
            width: 40px;
            height: 30px;
            font-size: 14px;
            line-height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .floor-button.clicked {
            background-color: green;
            color: white;
        }

        .elevator-shaft {
            position: relative;
            width: 60px;
            height: 100%;
            background-color: #ddd;
            margin-right: 10px;
            border-left: 2px solid #aaa;
        }

        .elevator {
            position: absolute;
            width: 100%;
            height: 40px;
            background-color: #666;
            transition: bottom 5s;
            box-shadow: inset 0 0 4px #000;
            color: white;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h2>מעלית עם תור קריאות</h2>
    <div class="building-container">
        <div class="building" id="building"></div>
        <div class="elevator-shaft">
            <div class="elevator" id="elevator">⬆</div>
        </div>
    </div>

    <script>

        const ELEVATOR_SPEED = 1000; // milliseconds

        class Elevator {

            constructor(elementId, floorHeight) {
                this.elevatorEl = document.getElementById(elementId);
                this.floorHeight = floorHeight;
                this.currentFloor = 0;
                this.queue = [];
                this.isMoving = false;
            }

            requestFloor(floor, button) {
                if (this.queue.includes(floor)) return;

                this.queue.push({ floor, button });
                this.processQueue();
            }

            async processQueue() {
                if (this.isMoving || this.queue.length === 0) return;

                this.isMoving = true;
                const next = this.queue.shift();

                next.button.classList.add('clicked');
                await this.moveTo(next.floor);
                next.button.classList.remove('clicked');

                this.isMoving = false;
                this.processQueue(); // Continue to next floor
            }

            moveTo(floor) {
                return new Promise(resolve => {
                    const bottom = floor * this.floorHeight;
                    this.elevatorEl.style.bottom = `${bottom}px`;
                    this.currentFloor = floor;
                    setTimeout(resolve, 1000); // wait for animation to complete
                });
            }
        }

        class Floor {
            constructor(number, onClickCallback) {
                this.number = number;
                this.element = this.createFloorElement(onClickCallback);
            }

            createFloorElement(onClick) {
                const floorRow = document.createElement('div');
                floorRow.className = 'floor-row';

                const floorDiv = document.createElement('div');
                floorDiv.className = 'floor';

                this.button = document.createElement('button');
                this.button.className = 'floor-button';
                this.button.textContent = this.number;

                this.button.addEventListener('click', () => onClick(this.number - 1, this.button));

                floorDiv.appendChild(this.button);
                floorRow.appendChild(floorDiv);

                return floorRow;
            }

            getElement() {
                return this.element;
            }
        }

        class FloorFactory {
            static createFloor(number, onClick) {
                return new Floor(number, onClick);
            }
        }

        class Building {
            constructor(buildingElId, numFloors, elevator) {
                this.buildingEl = document.getElementById(buildingElId);
                this.numFloors = numFloors;
                this.elevator = elevator;
                this.renderFloors();
            }

            renderFloors() {
                for (let i = 1; i <= this.numFloors; i++) {
                    const floor = FloorFactory.createFloor(i, (floorIndex, button) => {
                        this.elevator.requestFloor(floorIndex, button);
                    });
                    this.buildingEl.appendChild(floor.getElement());
                }
            }
        }

        // אתחול
        const NUM_FLOORS = 10;
        const FLOOR_HEIGHT = 40;

        const elevator = new Elevator('elevator', FLOOR_HEIGHT);
        const building = new Building('building', NUM_FLOORS, elevator);
    </script>

</body>

</html>